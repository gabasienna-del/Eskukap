name: Build LSPosed module (zip only)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-module:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Prepare module directory
        run: |
          rm -rf out
          mkdir -p out/module
          # copy smali if present
          if [ -d "smali" ]; then
            cp -r smali out/module/ || true
          fi
          # create module.prop
          cat > out/module/module.prop <<PROPMARK
id=CamYan
name=CamYan Hook
version=1.0
versionCode=1
author=Gabit
description=Hook module (ESKUKAP)
PROPMARK
          ls -la out/module || true

      - name: Pack module ZIP
        run: |
          SHA=$(git rev-parse --short HEAD)
          ZIPNAME="CamYan-module-${SHA}.zip"
          cd out
          zip -r "../${ZIPNAME}" module
          cd ..
          echo "Created: ${ZIPNAME}"
          ls -la ${ZIPNAME} || true

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: CamYan-module
          path: CamYan-module-*.zip
